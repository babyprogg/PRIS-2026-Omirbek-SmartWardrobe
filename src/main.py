import streamlit as st
from data_manager import InventoryManager

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –¥–∞–Ω–Ω—ã—Ö
data_path = "data/raw/inventory.csv"
manager = InventoryManager(data_path)

# –í –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
page = st.sidebar.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø:", ["–ì–ª–∞–≤–Ω–∞—è", "–ú–æ–π –®–∫–∞—Ñ", "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–µ–∂–¥—ã", "–ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–∏–ª—è"])

if page == "–ú–æ–π –®–∫–∞—Ñ":
    st.header("üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∞—à–µ–≥–æ –≥–∞—Ä–¥–µ—Ä–æ–±–∞")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∏–∑ CSV —á–µ—Ä–µ–∑ pandas
    st.dataframe(manager.data)
    
    st.subheader("–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—â—å")
    with st.form("add_item_form"):
        name = st.text_input("–ù–∞–∑–≤–∞–Ω–∏–µ")
        cat = st.selectbox("–ö–∞—Ç–µ–≥–æ—Ä–∏—è", ["Top", "Bottom", "Shoes"])
        clr = st.selectbox("–¶–≤–µ—Ç", ["–ë–µ–ª—ã–π", "–ß–µ—Ä–Ω—ã–π", "–°–∏–Ω–∏–π", "–ë–µ–∂–µ–≤—ã–π", "–ö—Ä–∞—Å–Ω—ã–π"])
        submit = st.form_submit_button("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É")
        
        if submit:
            new_item = {"id": len(manager.data)+1, "name": name, "category": cat, "color": clr}
            manager.add_item(new_item)
            st.success("–í–µ—â—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!")
            st.rerun()

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.title("AI Smart Wardrobe")

# –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –±—É–¥—É—â–∏—Ö –ª–∞–±)
st.sidebar.header("–ù–∞–≤–∏–≥–∞—Ü–∏—è")
page = st.sidebar.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø:", ["–ì–ª–∞–≤–Ω–∞—è", "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–µ–∂–¥—ã", "–ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–∏–ª—è"])

if page == "–ì–ª–∞–≤–Ω–∞—è":
    st.write("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª–∏—Å—Ç!")
    st.write("–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ–¥–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ò–ò.")
    
    if st.button("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º"):
        st.success("–í—Å–µ –º–æ–¥—É–ª–∏ (NLP, CV, Logic) –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã! üöÄ")

elif page == "–ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–µ–∂–¥—ã":
    st.header("–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ")
    uploaded_file = st.file_uploader("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ –≤–∞—à–µ–π –≤–µ—â–∏...", type=["jpg", "png", "jpeg"])
    if uploaded_file is not None:
        st.image(uploaded_file, caption='–í–∞—à–µ —Ñ–æ—Ç–æ', use_column_width=True)
        st.info("–ù–∞ —ç—Ç–∞–ø–µ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π ‚Ññ7 –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å CV-–º–æ–¥–µ–ª—å.")

elif page == "–ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–∏–ª—è":
    st.header("–≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞")
    st.write("–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ —Å–æ—á–µ—Ç–∞–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –∏ –¥—Ä–µ—Å—Å-–∫–æ–¥–∞.")

    # src/logic.py

class Garment:
    """–û–±—ä–µ–∫—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–µ–¥–º–µ—Ç–∞ –æ–¥–µ–∂–¥—ã (–õ–∞–±–∞ ‚Ññ3)"""
    def __init__(self, name, category, color):
        self.name = name
        self.category = category  # –Ω–∞–ø—Ä–∏–º–µ—Ä, 'Top', 'Bottom', 'Shoes'
        self.color = color

class StyleExpert:
    """–ú–∞—à–∏–Ω–∞ –≤—ã–≤–æ–¥–∞ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞—Ö (–õ–∞–±–∞ ‚Ññ2)"""
    def __init__(self):
        # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: –∫–∞–∫–∏–µ —Ü–≤–µ—Ç–∞ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è
        self.color_matches = {
            "–ë–µ–ª—ã–π": ["–ß–µ—Ä–Ω—ã–π", "–°–∏–Ω–∏–π", "–ö—Ä–∞—Å–Ω—ã–π", "–ó–µ–ª–µ–Ω—ã–π"],
            "–ß–µ—Ä–Ω—ã–π": ["–ë–µ–ª—ã–π", "–°–µ—Ä—ã–π", "–ö—Ä–∞—Å–Ω—ã–π", "–°–∏–Ω–∏–π"],
            "–°–∏–Ω–∏–π": ["–ë–µ–ª—ã–π", "–°–µ—Ä—ã–π", "–ë–µ–∂–µ–≤—ã–π"],
            "–ë–µ–∂–µ–≤—ã–π": ["–°–∏–Ω–∏–π", "–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π", "–ë–µ–ª—ã–π"]
        }

    def check_combination(self, item1, item2):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—á–µ—Ç–∞–µ–º–æ—Å—Ç–∏ –¥–≤—É—Ö –≤–µ—â–µ–π –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º if-then"""
        if item1.color in self.color_matches.get(item2.color, []) or \
           item2.color in self.color_matches.get(item1.color, []):
            return True, "‚úÖ –≠—Ç–∏ —Ü–≤–µ—Ç–∞ –æ—Ç–ª–∏—á–Ω–æ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è!"
        
        if item1.color == item2.color:
            return True, "‚ö™ –ú–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã–π –æ–±—Ä–∞–∑ ‚Äî —ç—Ç–æ —Å—Ç–∏–ª—å–Ω–æ."
        
        return False, "‚ö†Ô∏è –°–æ—á–µ—Ç–∞–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ø–æ—Ä–Ω–æ."

    def get_recommendation(self, occasion):
        """–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –¥—Ä–µ—Å—Å-–∫–æ–¥–∞ (–õ–∞–±–∞ ‚Ññ2)"""
        rules = {
            "–°–≤–∞–¥—å–±–∞": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –ö–æ—Å—Ç—é–º –∏–ª–∏ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–ª–∞—Ç—å–µ. –ò–∑–±–µ–≥–∞–π—Ç–µ —á–∏—Å—Ç–æ –±–µ–ª–æ–≥–æ.",
            "–†–∞–±–æ—Ç–∞": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –†—É–±–∞—à–∫–∞, –±—Ä—é–∫–∏ –∏–ª–∏ —é–±–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à. –î–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å.",
            "–ü—Ä–æ–≥—É–ª–∫–∞": "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –§—É—Ç–±–æ–ª–∫–∞, –¥–∂–∏–Ω—Å—ã –∏ —É–¥–æ–±–Ω–∞—è –æ–±—É–≤—å. Casual."
        }
        return rules.get(occasion, "–ü—Ä–æ—Å—Ç–æ –æ–¥–µ–Ω—å—Ç–µ—Å—å –ø–æ –ø–æ–≥–æ–¥–µ!")